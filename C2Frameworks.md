# Powershell-Empire

Powershell Empire has several major sections to it, which we will be covering in the upcoming tasks.

    Listeners are fairly self-explanatory. They listen for a connection and facilitate further exploitation
    Stagers are essentially payloads generated by Empire to create a robust reverse shell in conjunction with a listener. They are the delivery mechanism for agents
    Agents are the equivalent of a Metasploit "Session". They are connections to compromised targets, and allow an attacker to further interact with the system
    Modules are used to in conjunction with agents to perform further exploitation. For example, they can work through an existing agent to dump the password hashes from the server 
    
    
    
 ### Client Listener (CLI based Empire)
   
  1. Start powershell-empire server by command sudo powershell-empire server
  2. Now start powershell-empire client by command sudo powershell-empire client
  3. Now we can start the empire listner in client empire by command uselistener <listenertype>   
  
   A dropdown menu comesup and we can select listener of available types . http listener will be used mostly as its common
   
  4.  Now a table appears which have several options to be setted just like metasploit.
  5. We can set any option value by using keyword set and then option name just like msfconsole
  5. Its better to set a name for our listener so we can identify it easily
  6. Now type execute to start the listener
  7. When we want to stop a listener, we can use kill listenername
  
  
  (GUI based - starkiller)
  
  1. launch starkiller and login using its default credentials empireadmin:password123
  2. Now go to listener tabs and select a new listener
  3. NOw set its name ip port etc just like cli empire and then run it
  
  
  ### Client Stager (CLI based Empire)
  
  1. Now we will use stagers which are our payloads.These payloads get executed by agents(sessions) and connect back to our listener already running
  2. Type usestager stagename 
  
  dropdown menu will appear with different payloads
  
  multi/launcher  is generally used for windows target
  
  NOTE: If we are proxying and intend to execute the payload on an internal server we need to set the http_hop listener name in the listener option here.
  
  3. after that it will ask to set a listener from which we will catch the connection. Set this option to the listener name which we initially gave a listener.
  4. Also select the outfile option to /tmp on out local machine
  5. We can copy the generated payload in a file and now we have to execuet this payload from our target machine
  
  
  If our target can directly communicate back with us then we can simply execute the payload by pasting in target shell and getting connection back in our empire listener. But if we want to execute it in an internal server then we need to first follow the ##http_hop instructions and setup a relay on public exposed machine from where we will tunnel traffic between us and internal server.
  
  
  ### Client AGent (CLI based Empire)
  Now copy the generated payload and paste it in a file on target machine.DO it on /tmp or /dev/shm
  
  1. Now we can read the script file and see that code has two major parts.the payload and instructions to remove the file after single execution. If we eant to use this payload for long time just copy the payload part and paste it in terminal and execute directly
  2. Our listener will catch the connection back
  3. Now type interact AGENTNAME to interact with the agent
  4. We can type agents to see the running agents
  
  
  ### Client Hop listeners CLI based Empire)
  
 We use hop listeners when we need to get deeper into the nwtworks and deal with those machines which cannot directly communicate with outside network. WE create the ho listener and it creates a folder with some files replicating a real life like webserver and we have to move it to the target and then serve a webserver from there.
 
 1. uselistener http_hop to start a hop listener which acts like a socat relay etc
 2. we need to set Host(Compromised Public facing server which can directly communicate with us) , A Port which will be the relay port and redirectlistener which will be setted to a name of already running normal empire listener.

 3. set outfolder option to /tmp/http_hop
 4.   NOw type execute and start this .
 5. Now in our outfolder specified directory we will see that a replication of php webapplication is created. We need to transfer this to over to the public compromised server so it can act as a relay between internal server and our attackings machine
 6. Make a directory and transfer all the above files here and start a webserver here with the port number which we speciefied when creating the http_hop in empire-cli
 7. Either transfer the files onje by one or zip the entire folder of above files in our machine and transferring that zip in compromised machine in one command and then unzip.
 
 8. Open the port which we speciefied when creating http_hop in compromised target
 
>  firewall-cmd --zone=public --add-port PORT/tcp
 
 9. As php server is ideal for this,we can start serving this directory of replicated webapp by following command
 
 >  php -S 0.0.0.0:PORT &>/dev/null & 
 
 Remember that the port will be the same that we specified when creating http_hop in cli empire
 
 The reason why we didnt used the python server is because it cant interpret and execute php which is essential for Empire Framework
 
 We can also create this using gui starkiller
 
 
 ### Client module (CLI empire)

1. This module is the real game. after we have a active agent on target now we use empire modules for different purposes like getting hashes,privesc etc
2.  type usemodule . As expected, this will show a dropdown with a huge list of modules which can be loaded into the agent for execution.
3. For example sherlock module is used for privesc,mimikatz is used for dumping hashes etc
4. we set the agentname and then type execute and it will return us the results when complete
5.   
 
### Empire Shell
  
  We can also get the target shell access from empire cli shell.
  1. First interact with the agent name by interact agentname
  2. Them type shell just like msfconsole 

## Plugins (Empire) 

1. we can use custom made modules and are reffered as plugin. Just import the plugin file to the /plugin of empire working directory
2. to integrate it run "plugin pluginfile"
3. Now start pluginname
 
 
